# See http://www.appveyor.com/docs/appveyor-yml for many more options

#Publish to PowerShell Gallery with this key
environment:
  NuGetApiKey:
    secure: SecureNugetApiKeyComesHere

# Allow WMF5 (i.e. PowerShellGallery functionality)
os: WMF 5

skip_commits:
  files:
    - README.md

init:
  # Set "build version number" to "short-commit-hash" or when tagged to "tag name"
  - ps: >-
      if ($env:APPVEYOR_REPO_TAG -eq "true")
      {
        Update-AppveyorBuild -Version "$env:APPVEYOR_REPO_TAG_NAME"
        $env:packageVersion = "$env:APPVEYOR_REPO_TAG_NAME" 
      }
      else
      {
        Update-AppveyorBuild -Version "dev-$($env:APPVEYOR_REPO_COMMIT.substring(0,7))"
        $env:packageVersion = "0.0.1-dev"
      }


build: false

test_script:
  - ps: . .\build.ps1

deploy_script:
  - ps: . .\deploy.ps1
    on:
      branch: master
      appveyor_repo_tag: true